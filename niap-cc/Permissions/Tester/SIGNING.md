# Signing of the Permission Test Tool

## Build variants / Signing Key

The permission tester tool application needs to be executed with the combination 
of several types of AndroidManifest.xml and Signing Key, to evaluate wide variety 
of the Androidâ€™s permissions. 

To output these variants without pain, we install the build variants 
functionalities to the project. We defined 3 build variants to the project as 
it is like below. 

**Defined Variants**

| Variant name | Definition                                                                                             | Signing with |
|-------|--------------------------------------------------------------------------------------------------------|--------------|
| normal | Use the AndroidManifest.xml which granting all of the permissions, and signing with a non-platform key. | normal.jks   |
| noperm| Use the AndroidManifset.xml which granting **no permission**, and signing with a non-platform key.     | normal.jks   |
| platform | Use the AndroidManifset.xml which granting all of the permissions, and signing with the platform key.  | platform.jks |

## Signing key installation
The project requires 2 types of keystore file(jks) for signing.
Please prepare these files to run this project correctly. 
The jks file can be generated by the pk8 file and x509.pem file.

 - Normal signing key (normal.jks) 
   - The key for the running ordinal apis.
   - You can use any signing key for this purpose.
 - Platform signing key (platform.jks) 
   - The key for the running restricted apis like 'signature' or 'privileged' level.
   - Generally the key is related to the specific android builds and should be hidden to outside. 
   - We can find the platform.pk8 and platform.x509.pem for AOSP build below.
   - https://android.googlesource.com/platform/build/+/master/target/product/security
   
Those keys need to be put into the corresponding directories under

>**[:projectroot]**/security/**[keyname]**

## How can we generate a keystore file?

After preparing a pk8 file and a pem file type below command. 
The sample shows steps to generate platform.jks file contains a key named 'platform'.
(Openssl and jdk keytool are required.)
```
openssl pkcs8 -inform DER -nocrypt -in platform.pk8 -out platform.pem

openssl pkcs12 -export -in platform.x509.pem -inkey platform.pem -out platform.p12 -password pass:android -name platform

keytool -importkeystore -deststorepass android -destkeystore platform.jks -srcstoretype PKCS12 -srcstorepass android -srckeystore platform.p12
```

## Generate build variants

Once we prepared the above keystore files, 
We can choose a build setting from 'Build Variants' pane of Android Studio and get output file. 
 - https://developer.android.com/studio/build/build-variants
 
It is also possible to use below command to build those variants.
```
./gradlew assembleNormal
./gradlew assembleNoperm
./gradlew assemblePlatform
```
The build results would be output under a directory below
>**[:projectroot]**/app/build/outputs/apk

